<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movies</title>
<style>
body { margin: 0; font-family: Arial, sans-serif; background-color: #141414; color: #fff; }
header { background-color: #141414; padding: 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; }
header h1 { color: #e50914; margin: 0; }
input[type="text"] { padding: 8px; font-size: 16px; width: 300px; border-radius: 4px; border: none; }
section { margin-top: 20px; }
h2 { margin-left: 20px; }
.carousel-wrapper { position: relative; }
.carousel { display: flex; overflow-x: auto; gap: 10px; padding: 20px; scroll-behavior: smooth; cursor: grab; }
.carousel::-webkit-scrollbar { display: none; }
.movie-card { min-width: 150px; cursor: pointer; position: relative; transition: transform 0.3s; flex-shrink: 0; }
.movie-card img { width: 100%; border-radius: 8px; display: block; }
.movie-card:hover { transform: scale(1.2); z-index: 5; }
.movie-title { position: absolute; bottom: 5px; left: 5px; right: 5px; background-color: rgba(0,0,0,0.7); padding: 2px 4px; font-size: 14px; border-radius: 4px; text-align: center; }
.preview-card { position: absolute; top: -240px; left: 50%; transform: translateX(-50%); width: 300px; background-color: #222; padding: 10px; border-radius: 8px; display: none; flex-direction: column; z-index: 10; transition: all 0.3s ease; }
.preview-card img { width: 100%; border-radius: 8px; }
.preview-card h3 { margin: 5px 0; font-size: 16px; }
.preview-card p { font-size: 14px; color: #ccc; }
.preview-card .buttons { display: flex; gap: 10px; margin-top: 5px; }
.preview-card button { flex: 1; padding: 5px; font-size: 14px; border: none; border-radius: 4px; cursor: pointer; }
.preview-card .play { background-color: #e50914; color: #fff; }
.preview-card .add { background-color: #444; color: #fff; }
.preview-card .remove { background-color: #888; color: #fff; }
.arrow { position: absolute; top: 50%; transform: translateY(-50%); font-size: 40px; color: rgba(255,255,255,0.7); background-color: rgba(0,0,0,0.4); border-radius: 50%; padding: 5px 10px; cursor: pointer; z-index: 5; user-select: none; }
.arrow:hover { color: #fff; background-color: rgba(0,0,0,0.7); }
.left-arrow { left: 10px; }
.right-arrow { right: 10px; }
iframe { display: none; }
@media (max-width: 768px) {
    input[type="text"] { width: 150px; }
    .movie-card { min-width: 120px; }
    .preview-card { display: none !important; }
}
</style>
</head>
<body>

<header>
<h1>Movies</h1>
<input type="text" id="search" placeholder="Search movies...">
</header>

<section>
<h2>Trending Now</h2>
<div class="carousel-wrapper">
    <div class="arrow left-arrow" onclick="scrollCarousel('trending', -300)">&#10094;</div>
    <div class="arrow right-arrow" onclick="scrollCarousel('trending', 300)">&#10095;</div>
    <div class="carousel" id="trending"></div>
</div>

<h2>Top 10</h2>
<div class="carousel-wrapper">
    <div class="arrow left-arrow" onclick="scrollCarousel('top10', -300)">&#10094;</div>
    <div class="arrow right-arrow" onclick="scrollCarousel('top10', 300)">&#10095;</div>
    <div class="carousel" id="top10"></div>
</div>

<h2>My List</h2>
<div class="carousel-wrapper">
    <div class="arrow left-arrow" onclick="scrollCarousel('mylist', -300)">&#10094;</div>
    <div class="arrow right-arrow" onclick="scrollCarousel('mylist', 300)">&#10095;</div>
    <div class="carousel" id="mylist"></div>
</div>
</section>

<script>
const API_KEY = "8924320c";
let myList = []; // store movie objects

const trendingTitles = ["Avengers: Endgame", "Joker", "Spider-Man: No Way Home", "Black Panther", "Doctor Strange"];
const top10Titles = ["Inception", "Interstellar", "The Dark Knight", "Fight Club", "Pulp Fiction", "Forrest Gump", "The Matrix", "The Godfather", "The Lord of the Rings", "Gladiator"];

async function fetchMovies(titles){
    const movies = [];
    for(const title of titles){
        try{
            const res = await fetch(`https://www.omdbapi.com/?apikey=${API_KEY}&t=${encodeURIComponent(title)}`);
            const data = await res.json();
            if(data.Response === "True"){
                movies.push({title: data.Title, imdb: data.imdbID, poster: data.Poster, plot: data.Plot});
            }
        } catch(e){ console.error(e); }
    }
    return movies;
}

function renderCarousel(movies, containerId){
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    movies.forEach(movie=>{
        const card = document.createElement("div");
        card.className = "movie-card";
        card.innerHTML = `<img src="${movie.poster}" alt="${movie.title}"><div class="movie-title">${movie.title}</div>`;

        const preview = document.createElement("div");
        preview.className = "preview-card";
        preview.innerHTML = `
            <img src="${movie.poster}" alt="${movie.title}">
            <h3>${movie.title}</h3>
            <p>${movie.plot}</p>
            <div class="buttons">
                <button class="play">Play</button>
                ${containerId==="mylist"?'<button class="remove">Remove</button>':'<button class="add">Add to List</button>'}
            </div>
        `;
        card.appendChild(preview);

        card.onmouseenter = () => { preview.style.display = "flex"; };
        card.onmouseleave = () => { preview.style.display = "none"; };

        preview.querySelector(".play").onclick = (e) => {
            e.stopPropagation();
            window.open(`https://vidrock.net/movie/${movie.imdb}`, '_blank');
        };

        if(containerId==="mylist"){
            preview.querySelector(".remove").onclick = (e)=>{
                e.stopPropagation();
                myList = myList.filter(m=>m.imdb!==movie.imdb);
                renderCarousel(myList,"mylist");
            }
        } else {
            preview.querySelector(".add").onclick = (e)=>{
                e.stopPropagation();
                if(!myList.some(m=>m.imdb===movie.imdb)){
                    myList.push(movie);
                    renderCarousel(myList,"mylist");
                    alert(`${movie.title} added to your list!`);
                } else { alert(`${movie.title} is already in your list!`); }
            }
        }

        container.appendChild(card);
    });
}

function scrollCarousel(containerId, amount){
    const container = document.getElementById(containerId);
    container.scrollBy({left: amount, behavior: 'smooth'});
}

function addSwipe(containerId){
    const slider = document.getElementById(containerId);
    let isDown = false, startX, scrollLeft;
    slider.addEventListener('pointerdown', (e)=>{
        isDown = true; slider.style.cursor = 'grabbing';
        startX = e.pageX - slider.offsetLeft; scrollLeft = slider.scrollLeft;
    });
    slider.addEventListener('pointerleave', ()=>{ isDown=false; slider.style.cursor='grab'; });
    slider.addEventListener('pointerup', ()=>{ isDown=false; slider.style.cursor='grab'; });
    slider.addEventListener('pointermove', (e)=>{
        if(!isDown) return;
        e.preventDefault();
        const x = e.pageX - slider.offsetLeft;
        slider.scrollLeft = scrollLeft - (x - startX)*2;
    });
}

async function initMovies(){
    const trendingMovies = await fetchMovies(trendingTitles);
    const top10Movies = await fetchMovies(top10Titles);
    renderCarousel(trendingMovies, "trending");
    renderCarousel(top10Movies, "top10");
    renderCarousel(myList,"mylist");
    ["trending","top10","mylist"].forEach(addSwipe);
}

initMovies();

// Search
document.getElementById("search").addEventListener("keypress", function(e){
    if(e.key === "Enter"){
        const query = e.target.value;
        fetch(`https://www.omdbapi.com/?apikey=${API_KEY}&s=${encodeURIComponent(query)}`)
            .then(res => res.json())
            .then(data => {
                if(data.Search && data.Search.length>0){
                    window.open(`https://vidrock.net/movie/${data.Search[0].imdbID}`,'_blank');
                } else alert("Movie not found!");
            }).catch(err=>console.error(err));
    }
});
</script>
</body>
</html>
